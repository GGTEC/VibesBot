<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"></script>
  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css">
                
  <title>Document</title>
</head>
<body style="overflow: hidden; background-color: transparent;">
  <iframe id="myiframe" src="" frameborder="false" style="width: 100%;height: 100vh;"></iframe>
  <script>

    var iframe = document.getElementById('myiframe');
    var socket;

    let ConectionClosed = false
    
    function connectWebSocket() {

      if (socket && socket.readyState === WebSocket.OPEN) {
        return;
      }

      socket = new WebSocket("ws://localhost:7688");

      socket.onopen = function (event) {
        socket.send(JSON.stringify(message = { type: "highlighted" }))
      };

      socket.onmessage = function (event) {

        if (event.data === 'ping') {

          socket.send(JSON.stringify(message = { type: "pong" }))

        } else {

          var data_parse = JSON.parse(event.data);

          if (data_parse.type === 'highlighted') {
            
            var div = document.createElement('div');    

            div.style.border = "solid 3px #fff";
            div.style.borderColor = data_parse.border;
            div.style.backgroundColor = data_parse.background;
            div.style.padding = '1%'
            div.style.maxWidth = "100%";
            div.style.maxheight = "100vh";

            var style = document.createElement("style");
                style.type = "text/css";
                style.textContent = `
                    @import url('https://fonts.googleapis.com/css2?family=Kanit:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap');
                    @import url('https://fonts.googleapis.com/css2?family=Bangers&family=Kanit:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap');
                    @import url('https://db.onlinewebfonts.com/c/800e985f75a5a56c2f7b4be502d286de?family=Burbank+Big+Condensed+Bold');
                    body  {
                      overflow: hidden;
                      margin: 0;
                    }
                  `;

            if (data_parse.show_text == 1){

                div.innerHTML = data_parse.html
                
            } else {
                div.innerHTML = ""
            }

            var div_html = document.createElement('html')
            div_html.appendChild(style)
            div_html.appendChild(div)


            iframe.contentDocument.documentElement.innerHTML = div_html.outerHTML;
            

          } else if (data_parse.type == 'close') { ConectionClosed = true }
        }
      };

      socket.onclose = function (error) {
        if (ConectionClosed == false) { reconnectWebSocket(); }
      };

    }

    function reconnectWebSocket() {
      if (!socket || socket.readyState === WebSocket.CLOSED) {
        setTimeout(function () { connectWebSocket(); }, 3000);
      }
    }
    connectWebSocket();

  </script>
</body>

</html>